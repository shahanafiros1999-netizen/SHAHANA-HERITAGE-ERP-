openapi: 3.0.3
info:
  title: Shahana Heritage ERP API
  version: "v1"
servers:
  - url: https://api.kc-capitals.com/v1
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        mobile: { type: string }
    Proposal:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        body: { type: string }
        voting_model: { type: string }
paths:
  /auth/login:
    post:
      summary: Login via mobile (OTP)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                mobile: { type: string }
      responses:
        '200':
          description: OTP sent
  /auth/token:
    post:
      summary: Exchange OTP for JWT
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                mobile: { type: string }
                otp: { type: string }
      responses:
        '200':
          description: tokens
  /connectors/plaid/link:
    post:
      summary: Create link token for Plaid
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                family_id: { type: string }
      responses:
        '200':
          description: link token
  /webhook/connector/{provider}/transactions:
    post:
      summary: Connector webhook for transactions
      parameters:
        - name: provider
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200':
          description: accepted
  /vault/unlock-request:
    post:
      summary: Create a vault unlock request (Two-key flow)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                folder_id: { type: string }
                reason: { type: string }
                expires_in_hours: { type: integer }
      responses:
        '201':
          description: request created
  /vault/approve/{requestId}:
    post:
      summary: Approve unlock (signature)
      security: [{ bearerAuth: [] }]
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                approver_id: { type: string }
                signature: { type: string } # base64 or signature object
      responses:
        '200':
          description: approval recorded
  /proposals:
    post:
      summary: Create a proposal
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Proposal'
      responses:
        '201':
          description: created
    get:
      summary: List proposals
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: list
  /proposals/{id}/vote:
    post:
      summary: Cast a vote
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                choice: { type: string, enum: [yes,no,abstain] }
                weight: { type: number }
      responses:
        '200':
          description: recorded
  /finance/manual-transaction:
    post:
      summary: Post manual transaction to ledger
      security: [{ bearerAuth: [] }]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                account_id: { type: string }
                amount: { type: number }
                date: { type: string, format: date }
                description: { type: string }
      responses:
        '201':
          description: transaction created
  /admin/simulate-dms/{family_id}:
    post:
      summary: Simulate DMS activation for staging/testing
      parameters:
        - name: family_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                inactivity_days: { type: integer }
                signals_required:
                  type: array
                  items: { type: string }
                successors:
                  type: array
                  items: { type: string }
                cooling_period_days: { type: integer }
      responses:
        '200':
          description: simulation result (status)
  /vault/requests/{requestId}/status:
    get:
      summary: Get unlock request status and temporary token if issued
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: string }
      security:
        - bearerAuth: []
      responses:
        '200':
          description: status object with optional temp_token
  /vault/revoke-temp-token:
    post:
      summary: Revoke a temporary token (immediate)
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token: { type: string }
      responses:
        '200':
          description: revocation success
  /webhook/approver/callback:
    post:
      summary: Approver external callback endpoint (for lawyer sign services)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                request_id: { type: string }
                approver_id: { type: string }
                signature: { type: string }
                signed_at: { type: string, format: date-time }
      responses:
        '200':
          description: accepted
security:
  - bearerAuth: []